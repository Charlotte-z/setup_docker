name: entrance

on:
  push:

jobs:
  delete_test:
    runs-on: ubuntu-latest
    steps:
      - id: version
        uses: battila7/get-version-action@v2
      - name: Login ghcr
        uses: docker/login-action@v1
        with:
          registry: ghcr.io/geekrv
          username: ${{ github.actor }}
          password: ${{ secrets.TOKEN }}
      - name: Retag to latest
        uses: Z-M-Huang/docker-retag-curl@0.1.0
        with:
          repo: ghcr.io/geekrv/workflow
          old_tag: test7.2ec8b53
          new_tag: wwwwww
          username: github
          password: ${{ secrets.TOKEN }}
      # -H 'Authorization: Bearer ${{ secrets.TOKEN }}' \
      # -H "Accept: application/vnd.github.v3+json" \
      # https://api.github.com/orgs/geekrv/packages/container/workflow/versions?page=3&&per_page=100
      #https://api.github.com/users/USERNAME/packages/PACKAGE_TYPE/PACKAGE_NAME/versions/PACKAGE_VERSION_ID


# curl -i \
# -X DELETE \
# -H 'Authorization: Bearer ${{ secrets.TOKEN }}' \
# -H "Accept: application/vnd.github.v3+json" \
# https://api.github.com/geekrv/workflow/typescript-monorepo-example-main-internal-api/versions/

  # test:
  #   name: aww
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v2
  #     - uses: benjlevesque/short-sha@v1.2
  #       id: short-sha
  #     - name: ssss
  #       run: |
  #         echo '${{ toJSON(github) }}'
  #     - name: trim branch
  #       uses: Charlotte-z/workflows/trim_branch@main
  #     - name: setup docker and login
  #       uses: Charlotte-z/workflows/setup_docker@main
  #       with:
  #         registry: ghcr.io/geekrv/workflow
  #         username: ${{ github.actor }}
  #         password: ${{ secrets.TOKEN }}
  #     - run: echo ${{ steps.short-sha.outputs.sha }}
  #     - name: Build image and push to GitHub Container Registry
  #       uses: docker/build-push-action@v3
  #       with:
  #         context: .
  #         push: true
  #         platforms: linux/amd64, linux/arm64
  #         tags: |
  #           ghcr.io/geekrv/workflow:${{ env.TRIM_BRANCH }}.${{ steps.short-sha.outputs.sha }}

  # build-a:
  #   uses: ./.github/workflows/build-a.yml

  # build-b:
  #   uses: ./.github/workflows/build-b.yml

  # integration:
  #   needs: [build-b, build-a]
  #   uses: ./.github/workflows/test-integration.yml